#!/usr/bin/env bash

# Exit immediately if a command exits with a non-zero status
set -e

cd "$(dirname "$0")/../docs"

# Ensure Ruby gems path is in PATH
export PATH="$PATH:/home/vscode/.local/share/gem/ruby/3.3.0/bin"

# Check if bundle is available
if ! command -v bundle &> /dev/null; then
    echo "Bundle not found. Installing bundler..."
    gem install bundler
fi

# Install/update dependencies if needed
if [[ ! -f "Gemfile.lock" ]] || [[ "Gemfile" -nt "Gemfile.lock" ]]; then
    echo "Installing/updating dependencies..."
    bundle install
fi

echo "Starting Jekyll server for documentation preview..."
echo "Site will be available at: http://localhost:4000/ha-smart-cover-automation/"
echo "Press Ctrl+C to stop the server."
echo

# Start Jekyll server
bundle exec jekyll serve --host 0.0.0.0 --port 4000 --livereload